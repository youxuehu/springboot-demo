<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        /*表格样式*/
        table {
            width: 90%;
            background: #ccc;
            margin: 10px auto;
            border-collapse: collapse;/*border-collapse:collapse合并内外边距(去除表格单元格默认的2个像素内外边距*/
        }
        thead,th,td {
            height: 25px;
            line-height: 25px;
            text-align: left;
            border: 1px solid #ccc;
        }
        /*th {*/
        /*    background: #eee;*/
        /*    font-weight: normal;*/
        /*}*/
        tbody,tr {
            background: #fff;
        }
        tr:hover {
            background: #cc0;
        }
    </style>
</head>
<body>
    <h1>HDFS文件上传</h1>
    <form id="form1" enctype="multipart/form-data" method="post" action="/file/uploadToHdfs">
        <div class="row">
            <h1><label>Select a File to Upload</label></h1><br>
            <h1><input type="file" name="file" id="file" value="" placeholder="请选择"></h1>
        </div>
        <div class="row"  style="margin-top: 50px;">
            <input type="button" id="uploadButton" value="上传文件" style="width:100px;height:50px;background-color: #00b3ee">
        </div>
        <div id="progressNumber"></div>
    </form>
    <h1 id="uploadMessage" style="color: red">111</h1>
    <br/><br/><br/><br/>
    <button name="btn" id="seeDir" value="查看目录">查看目录</button>
    <br/>
    <table border="1">
        <thead>
            <th>
                <td>name</td>
                <td>path</td>
            </th>
        </thead>
        <tbody id="tb">

        </tbody>
    </table>

</body>
<script
        src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
<script>
    $(function(){
        const path = "/";
        $("#seeDir").click(function(){
            $.post("/file/listDir",{path:path},function(data,status){
                data.forEach(item => {
                    console.log(item);
                    $("#tb").append("<tr>\n" +
                                        "<td>"+item.name+"</td>\n" +
                                        "<td>"+item.path+"</td>\n" +
                                    "</tr>")
                })

            });
        });
        $("#uploadButton").click(function () {
            // 判断文件是否为空
            const fileInput = $('#file').get(0).files[0];
            console.log('fileInput=' + fileInput)
            if(fileInput){
                const formData = new FormData()
                formData.append("file", $("#file")[0].files[0]);
                console.log('formData=' + formData)
                if (formData == {}) {
                    alert("请选择文件！！")
                    $("#uploadMessage").text("请选择文件！！");
                }
                $.ajax({
                    url: '/file/uploadToHdfs',
                    type: 'post',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        console.log('info: ' + res.toString());
                        if (res["success"] == "true") {
                            alert('成功' + res['data']);
                            $("#uploadMessage").text(res['data']);
                        } else if (res["success"] == "false") {
                            alert('失败' + res['data']);
                            $("#uploadMessage").text(res['data']);
                        } else {
                            console.log(res);
                        }
                    }
                });
            }else{
                alert("请选择文件！！")
                $("#uploadMessage").text("请选择文件！！");
            }
        })
    });
</script>
</html>